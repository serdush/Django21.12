## Лекция 5. Создание простейшей модели данных

***Задача:*** разобраться как взаимодействовать нашему пиложению с моделью, которую мы опишем.
***Проблема***: что такое модель?

### Шаг 1. Модель - это ...
***Модель*** - это набор правил по взаимодействию программных объектов (сущностей) с базой данных.

Допустим, мы договорились, что будем хранить информацию про книгу следующим образом:
```
id | title | author | pages | price
```
Но в один прекрасный день, понадобилось модифицировать данную схему хранения:
```
id | title | author | pages | price | owner 
```

Как называется процесс ***перехода от одной схемы хранения данных к другой***?  - Это ***миграция***.

***Миграцией*** - называют процесс переход от одной схемы хранения данных к другой без утраты имеющейся инфомрации в БД.

Для того, чтобы выоплнить миграцию необходимо ***подготовить запросы по изменению схемы хранения данных в таблицах*** ( ```ALTER TABLE .......```) - ***подготовка миграции***.

***Миграция*** - это процесс применения запросов, подготовленных на предыдущем этапе.



### Шаг 2. Инициализация приложения.
***Хотелки***: хотим создать приложение в котором будет задана одна модель - ```Post``` (пост в блоге).

* ```pipenv shell```
* ```pipenv install django```
* ```django-admin startproject project .```
* ```python manage.py startapp posts```
* Заходим в ```project/settings.py``` -> ```INSTALLED_APPS``` - > 
```
INSTALLED_APPS = [
    'posts.apps.PostsConfig', # Регистрация приложения для проекта
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
]

```

### Шаг 3. Первичная миграция.
Для осуществления первичной миграции в ручном режиме необходимо выполнить команду:
```
python manage.py migrate
```
***Замечание***: на этом этапе нам не нужно подготавливать запросы по изменения структуры БД, т.к. они уже были подготовлены стандратными (встроенными) приложениями в ```Django```.


### Шаг 4. Создание первой модели ```Post```
Для создания первой модели переходим в приложение в ```posts/models.py```
```
from django.db import models

# Create your models here.
class Post(models.Model):
    text = models.TextField()

```

***Теперь*** подготовим запросы по изменению схемы текующей базы данных - подготовить миграцию.
```
python manage.py makemigrations posts
```

***После этого*** применим этим запросы:
```
python manage.py migrate posts
```

### Шаг 5. Django Admin
Для взаимодействия с моделью выберем самый простой путь - зайдем через панель администратора.
Для того, чтобы туда попасть необходимо создать пользователя с правами администратора:
```
python manage.py createsuperuser
```

Теперь запустим сервер ```python manage.py runserver``` и перейдем по адресу ```admin/```.

### Шаг 6. Регистрация модели в панели администратора
Для того, чтобы админ мог взаимодействовать с моделью ```Post``` из-под панели администратора, необходимо зайти в файл ```posts/admin.py```
```
from django.contrib import admin
from .models import Post
# Register your models here.

admin.site.register(Post)
```

Теперь в панели администратора доступна наша модель и есть проблема - после создания нового поста информация о нем очень криво отображается. Изменим это:
```
posts/models.py

from django.db import models

# Create your models here.
class Post(models.Model):
    text = models.TextField()

    def __str__(self):
        return self.text

```

Миграции не подготавливаем потому что ***структура данных не менялась***.

### Шаг 7. Добавление моделей в шаблоны.

